name: "Notify Discord on Push to Main"

on:
  push:
    branches:
      - main

jobs:
  discord-notify:
    runs-on: ubuntu-latest
    steps:
      - name: Notify Discord with commit embed
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
          COMMIT_URL: ${{ github.event.head_commit.url }}
        run: |
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$(jq -n \
                 --arg msg "$COMMIT_MESSAGE" \
                 --arg url "$COMMIT_URL" \
                 --arg timestamp "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
                 '{
                   "embeds": [
                     {
                       "title": "üöÄ Gospel Go deployed!",
                       "description": "**Message:** \($msg)\n[üåê Visit site](https://gospelgo.org) | [üîó View commit](\($url))",
                       "color": 3066993,
                       "timestamp": $timestamp
                     }
                   ]
                 }')" \
               $DISCORD_WEBHOOK
